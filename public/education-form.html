<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Add Education</title>
  <link rel="stylesheet" href="assets/css/education.css">
</head>
<body>
  <div class="form-container">
    <h2>Add Education</h2>
    <form id="education-form">
      
      <label for="institution">Institution</label>
      <input type="text" id="institution" name="institution" required>
      <div class="error-message"></div>

      <label for="degree">Degree</label>
      <input type="text" id="degree" name="degree" required>
      <div class="error-message"></div>

      <label for="field_of_study">Field of Study</label>
      <input type="text" id="field_of_study" name="field_of_study" required>
      <div class="error-message"></div>

      <label for="start_date">Start Date</label>
      <input type="date" id="start_date" name="start_date" required>
      <div class="error-message"></div>

      <label for="end_date">End Date</label>
      <input type="date" id="end_date" name="end_date">
      <div class="error-message"></div>

      <label for="is_current">Currently Studying</label>
      <input type="checkbox" id="is_current" name="is_current">
      <div class="error-message"></div>

      <label for="description">Description</label>
      <textarea id="description" name="description"></textarea>
      <div class="error-message"></div>

      <button type="submit">Save Education</button>
    </form>

    <div class="extra-links">
      <a href="jobseeker-profile.html">Back to Profile</a>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const token = localStorage.getItem("token");
      if (!token) {
        alert("Not logged in");
        window.location.href = "login.html";
        return;
      }

      document.getElementById("education-form").addEventListener("submit", async (e) => {
        e.preventDefault();

        // Collect and validate form data
        const institution = document.getElementById("institution").value.trim();
        const degree = document.getElementById("degree").value.trim();
        const field = document.getElementById("field_of_study").value.trim();
        const start = document.getElementById("start_date").value;
        const end = document.getElementById("end_date").value;
        const isCurrent = document.getElementById("is_current").checked;
        const description = document.getElementById("description").value.trim();

        if (!institution || !degree || !field || !start) {
          alert("Institution, degree, field of study, and start date are required.");
          return;
        }

        const eduData = {
          institution,
          degree,
          field_of_study: field,
          start_date: start,
          end_date: end || null,
          is_current: isCurrent,
          description
        };

        try {
          const res = await fetch("http://localhost:5050/api/education", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: `Bearer ${token}`
            },
            body: JSON.stringify(eduData)
          });

          if (!res.ok) {
            const errMsg = await res.text();
            throw new Error(errMsg || "Failed to add education");
          }

          const result = await res.json();
          alert("Education added successfully!");
          console.log("Added education:", result);

          // Redirect back to profile page
          window.location.href = "jobseeker-profile.html";
        } catch (err) {
          console.error("Error adding education:", err);
          alert("Could not add education. Please try again.");
        }
      });
    });
  </script>
</body>
</html>
