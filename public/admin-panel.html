<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <link rel="stylesheet" href="assets/css/admin-panel.css">
</head>
<body>
  <header class="admin-header">
    <h1>JobPortal Admin Panel</h1>
    <nav>
      <a href="#dashboard">Dashboard</a>
      <a href="#users">Users</a>
      <a href="#jobs">Jobs</a>
      <a href="#applications">Applications</a>
      <a href="#settings">Settings</a>
    </nav>
  </header>

  <main>
    <!-- Dashboard -->
    <section id="dashboard" class="panel-section">
      <h2>Dashboard Overview</h2>
      <div class="stats">
        <div class="stat-card">Jobseekers: <span id="stat-jobseekers">0</span></div>
        <div class="stat-card">Employers: <span id="stat-employers">0</span></div>
        <div class="stat-card">Jobs Posted: <span id="stat-jobs">0</span></div>
        <div class="stat-card">Applications: <span id="stat-applications">0</span></div>
      </div>
    </section>

    <!-- Users -->
    <section id="users" class="panel-section">
      <h2>User Management</h2>
      <table class="styled-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Role</th>
            <th>Email / Username</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Filled dynamically -->
        </tbody>
      </table>
    </section>

    <!-- Jobs -->
    <section id="jobs" class="panel-section">
      <h2>Job Management</h2>
      <table class="styled-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Employer</th>
            <th>Employer Email</th>
            <th>Location</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="jobsTableBody">
          <!-- Filled dynamically -->
        </tbody>
      </table>
    </section>

    <!-- Applications -->
    <section id="applications" class="panel-section">
      <h2>Application Management</h2>
      <table class="styled-table">
        <thead>
          <tr>
            <th>Applicant</th>
            <th>Applicant Email</th>
            <th>Job Title</th>
            <th>Employer</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="applicationsTableBody">
          <!-- Filled dynamically -->
        </tbody>
      </table>
    </section>

    <!-- Settings -->
    <section id="settings" class="panel-section">
      <h2>System Settings</h2>
      <p>Manage categories, industries, and announcements here.</p>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const token = localStorage.getItem("adminToken");
      if (!token) {
        alert("No admin token found. Please log in again.");
        window.location.href = "/login.html";
        return;
      }

      try {
        // Fetch dashboard stats
        const statsRes = await fetch("/api/admin/dashboard", {
          headers: { "Authorization": `Bearer ${token}` }
        });
        const stats = await statsRes.json();

        document.getElementById("stat-jobseekers").textContent = stats.jobseekersCount;
        document.getElementById("stat-employers").textContent = stats.employersCount;
        document.getElementById("stat-jobs").textContent = stats.jobsCount;
        document.getElementById("stat-applications").textContent = stats.applicationsCount;

        // Fetch users
        const usersRes = await fetch("/api/admin/users", {
          headers: { "Authorization": `Bearer ${token}` }
        });
        const users = await usersRes.json();
        const usersTableBody = document.getElementById("usersTableBody");
        usersTableBody.innerHTML = users.map(u => `
          <tr>
            <td>${u.name || u.companyName || "N/A"}</td>
            <td>${u.role}</td>
            <td>${u.email}</td>
            <td>${u.status || "Active"}</td>
            <td><button class="btn-warning">Toggle</button></td>
          </tr>
        `).join("");

        // Fetch jobs
        const jobsRes = await fetch("/api/admin/jobs", {
          headers: { "Authorization": `Bearer ${token}` }
        });
        const jobs = await jobsRes.json();
        const jobsTableBody = document.getElementById("jobsTableBody");
        jobsTableBody.innerHTML = jobs.map(j => `
          <tr>
            <td>${j.title}</td>
            <td>${j.employerName}</td>
            <td>${j.employerEmail}</td>
            <td>${j.location}</td>
            <td>${j.status}</td>
            <td>
              <button class="btn-success">Approve</button>
              <button class="btn-danger">Reject</button>
              <button class="btn-secondary">Delete</button>
            </td>
          </tr>
        `).join("");

        // Fetch applications
        const appsRes = await fetch("/api/admin/applications", {
          headers: { "Authorization": `Bearer ${token}` }
        });
        const applications = await appsRes.json();
        const applicationsTableBody = document.getElementById("applicationsTableBody");
        applicationsTableBody.innerHTML = applications.map(a => `
          <tr>
            <td>${a.applicantName}</td>
            <td>${a.applicantEmail}</td>
            <td>${a.jobTitle}</td>
            <td>${a.employerName}</td>
            <td>${a.status}</td>
          </tr>
        `).join("");

      } catch (err) {
        console.error("Error loading admin data:", err);
        alert("Failed to load admin data. Please try again.");
      }
    });
    try {
  const statsRes = await fetch("/api/admin/dashboard", {
    headers: { "Authorization": `Bearer ${token}` }
  });
  const stats = await statsRes.json();
} catch (err) {
  alert("Failed to load admin data. Please try again.");
}

  </script>
</body>
</html>
